```
4. Stud_info => sid, sname, branch, semester, mobno, email sid Book_info => bid, bname, author, issue_date,

For the given table structure, execute followings.

a. Write a stored procedure to display student details using student name as parameter.

b. Display student names starting with "Ra"

c. Display names of students those who have issued a book with bname as "Programming".

d. Modify the author name of the book having bid as 'BK11001' to 'Henry J.'
```



Complete Solution for Student-Book Database System

ðŸ“Œ STEP 1: CREATE TABLES WITH PROPER STRUCTURE

```sql
-- Create Student Information Table
CREATE TABLE Stud_info (
    sid VARCHAR(10) PRIMARY KEY,
    sname VARCHAR(100) NOT NULL,
    branch VARCHAR(50),
    semester INT CHECK (semester BETWEEN 1 AND 8),
    mobno VARCHAR(15),
    email VARCHAR(100)
);

-- Create Book Information Table
CREATE TABLE Book_info (
    bid VARCHAR(20) PRIMARY KEY,
    bname VARCHAR(100),
    author VARCHAR(100),
    issue_date DATE,
    sid VARCHAR(10),
    FOREIGN KEY (sid) REFERENCES Stud_info(sid)
);
```

ðŸ“Œ STEP 2: INSERT SAMPLE DATA

```sql
-- Insert Student Data
INSERT INTO Stud_info (sid, sname, branch, semester, mobno, email) VALUES
('S001', 'Rahul Sharma', 'Computer Science', 3, '9876543210', 'rahul.sharma@email.com'),
('S002', 'Raj Patel', 'Electronics', 4, '8765432109', 'raj.patel@email.com'),
('S003', 'Ravi Kumar', 'Mechanical', 2, '7654321098', 'ravi.kumar@email.com'),
('S004', 'Ram Singh', 'Computer Science', 5, '6543210987', 'ram.singh@email.com'),
('S005', 'Amit Verma', 'Civil', 6, '5432109876', 'amit.verma@email.com'),
('S006', 'Rakesh Gupta', 'Computer Science', 3, '4321098765', 'rakesh.gupta@email.com'),
('S007', 'Suresh Reddy', 'Electronics', 4, '3210987654', 'suresh.reddy@email.com'),
('S008', 'Ramesh Joshi', 'Mechanical', 2, '2109876543', 'ramesh.joshi@email.com'),
('S009', 'Priya Singh', 'Computer Science', 7, '1098765432', 'priya.singh@email.com'),
('S010', 'Neha Gupta', 'Civil', 3, '0987654321', 'neha.gupta@email.com');

-- Insert Book Issue Data
INSERT INTO Book_info (bid, bname, author, issue_date, sid) VALUES
('BK11001', 'Programming in C', 'James Gosling', '2024-01-15', 'S001'),
('BK11002', 'Data Structures', 'Robert Lafore', '2024-02-10', 'S002'),
('BK11003', 'Programming in Python', 'Mark Lutz', '2024-02-20', 'S003'),
('BK11004', 'Algorithms', 'Thomas Cormen', '2024-03-01', 'S001'),
('BK11005', 'Programming Fundamentals', 'Henry J. Williams', '2024-03-05', 'S004'),
('BK11006', 'Database Systems', 'Raghu Ramakrishnan', '2024-03-10', 'S006'),
('BK11007', 'Java Programming', 'James Gosling', '2024-03-12', 'S006'),
('BK11008', 'C++ Programming', 'Bjarne Stroustrup', '2024-03-15', 'S007'),
('BK11009', 'Web Programming', 'Jon Duckett', '2024-03-18', 'S002'),
('BK11010', 'Advanced Programming', 'Robert Martin', '2024-03-20', 'S004'),
('BK11011', 'Python Programming', 'Mark Lutz', '2024-03-22', 'S009'),
('BK11012', 'C Programming', 'Kernighan & Ritchie', '2024-03-25', 'S010'),
('BK11013', 'Programming Basics', 'Henry J. Williams', '2024-03-28', 'S003');
```

---

âœ… a. STORED PROCEDURE TO DISPLAY STUDENT DETAILS

SQL Server Syntax:

```sql
-- Create stored procedure
CREATE PROCEDURE GetStudentDetails
    @student_name VARCHAR(100)
AS
BEGIN
    SELECT 
        sid AS Student_ID,
        sname AS Student_Name,
        branch AS Branch,
        semester AS Semester,
        mobno AS Mobile_Number,
        email AS Email
    FROM Stud_info
    WHERE sname LIKE '%' + @student_name + '%'
    ORDER BY sname;
    
    -- If no records found
    IF @@ROWCOUNT = 0
        PRINT 'No student found with name containing: ' + @student_name;
END;
GO

-- Execute the procedure
EXEC GetStudentDetails 'Rahul';
EXEC GetStudentDetails 'Sharma';
EXEC GetStudentDetails 'Singh';
```

MySQL Syntax:

```sql
-- Create stored procedure
DELIMITER $$

CREATE PROCEDURE GetStudentDetails(IN student_name VARCHAR(100))
BEGIN
    SELECT 
        sid AS Student_ID,
        sname AS Student_Name,
        branch AS Branch,
        semester AS Semester,
        mobno AS Mobile_Number,
        email AS Email
    FROM Stud_info
    WHERE sname LIKE CONCAT('%', student_name, '%')
    ORDER BY sname;
    
    -- Check if any rows were returned
    IF FOUND_ROWS() = 0 THEN
        SELECT CONCAT('No student found with name containing: ', student_name) AS Message;
    END IF;
END$$

DELIMITER ;

-- Execute the procedure
CALL GetStudentDetails('Rahul');
CALL GetStudentDetails('Gupta');
```

PostgreSQL Syntax:

```sql
-- Create stored procedure
CREATE OR REPLACE PROCEDURE GetStudentDetails(
    IN student_name VARCHAR(100)
)
LANGUAGE plpgsql
AS $$
BEGIN
    -- Display student details
    RAISE NOTICE 'Searching for students with name containing: %', student_name;
    
    PERFORM sid, sname, branch, semester, mobno, email
    FROM Stud_info
    WHERE sname ILIKE '%' || student_name || '%'
    ORDER BY sname;
    
    -- Check if any rows were returned
    IF NOT FOUND THEN
        RAISE NOTICE 'No student found with name containing: %', student_name;
    END IF;
END;
$$;

-- Execute the procedure
CALL GetStudentDetails('Rahul');

-- Alternative: Using function to return results
CREATE OR REPLACE FUNCTION GetStudentDetailsFunc(
    student_name VARCHAR(100)
)
RETURNS TABLE (
    student_id VARCHAR(10),
    student_name VARCHAR(100),
    branch VARCHAR(50),
    semester INT,
    mobile VARCHAR(15),
    email VARCHAR(100)
) AS $$
BEGIN
    RETURN QUERY
    SELECT 
        si.sid,
        si.sname,
        si.branch,
        si.semester,
        si.mobno,
        si.email
    FROM Stud_info si
    WHERE si.sname ILIKE '%' || student_name || '%'
    ORDER BY si.sname;
END;
$$ LANGUAGE plpgsql;

-- Execute the function
SELECT * FROM GetStudentDetailsFunc('Patel');
```

---

âœ… b. DISPLAY STUDENT NAMES STARTING WITH "Ra"

Solution 1: Using LIKE Operator

```sql
SELECT 
    sid AS Student_ID,
    sname AS Student_Name,
    branch AS Branch,
    semester AS Semester,
    email AS Email
FROM Stud_info
WHERE sname LIKE 'Ra%'
ORDER BY sname;
```

Solution 2: Using LEFT Function

```sql
SELECT 
    sid,
    sname,
    branch,
    semester,
    email
FROM Stud_info
WHERE LEFT(sname, 2) = 'Ra'
ORDER BY sname;
```

Solution 3: Using SUBSTRING Function

```sql
SELECT 
    sid,
    sname,
    branch,
    semester,
    email
FROM Stud_info
WHERE SUBSTRING(sname, 1, 2) = 'Ra'
ORDER BY sname;
```

Solution 4: Using REGEXP (Pattern Matching)

```sql
-- MySQL
SELECT 
    sid,
    sname,
    branch,
    semester,
    email
FROM Stud_info
WHERE sname REGEXP '^Ra'
ORDER BY sname;

-- PostgreSQL
SELECT 
    sid,
    sname,
    branch,
    semester,
    email
FROM Stud_info
WHERE sname ~ '^Ra'
ORDER BY sname;

-- SQL Server
SELECT 
    sid,
    sname,
    branch,
    semester,
    email
FROM Stud_info
WHERE sname LIKE 'Ra%'
ORDER BY sname;
```

Expected Output:

```
sid   | sname         | branch          | semester | email
------|---------------|-----------------|----------|----------------------
S001  | Rahul Sharma  | Computer Science| 3        | rahul.sharma@email.com
S002  | Raj Patel     | Electronics     | 4        | raj.patel@email.com
S003  | Ravi Kumar    | Mechanical      | 2        | ravi.kumar@email.com
S004  | Ram Singh     | Computer Science| 5        | ram.singh@email.com
S006  | Rakesh Gupta  | Computer Science| 3        | rakesh.gupta@email.com
S008  | Ramesh Joshi  | Mechanical      | 2        | ramesh.joshi@email.com
```

---

âœ… c. DISPLAY NAMES OF STUDENTS WHO ISSUED A BOOK WITH BNAME AS "PROGRAMMING"

Solution 1: Using INNER JOIN

```sql
SELECT DISTINCT
    s.sid AS Student_ID,
    s.sname AS Student_Name,
    s.branch AS Branch,
    b.bname AS Book_Name,
    b.issue_date AS Issue_Date
FROM Stud_info s
INNER JOIN Book_info b ON s.sid = b.sid
WHERE b.bname LIKE '%Programming%'
ORDER BY s.sname, b.issue_date DESC;
```

Solution 2: Using EXISTS

```sql
SELECT 
    s.sid,
    s.sname,
    s.branch,
    s.semester
FROM Stud_info s
WHERE EXISTS (
    SELECT 1
    FROM Book_info b
    WHERE b.sid = s.sid
    AND b.bname LIKE '%Programming%'
)
ORDER BY s.sname;
```

Solution 3: Using IN

```sql
SELECT 
    s.sid,
    s.sname,
    s.branch,
    s.semester
FROM Stud_info s
WHERE s.sid IN (
    SELECT DISTINCT sid
    FROM Book_info
    WHERE bname LIKE '%Programming%'
)
ORDER BY s.sname;
```

Solution 4: Detailed Information

```sql
SELECT 
    s.sname AS Student_Name,
    s.branch AS Branch,
    s.semester,
    b.bname AS Book_Title,
    b.author AS Author,
    b.issue_date AS Issued_On,
    DATEDIFF(day, b.issue_date, GETDATE()) AS Days_Issued
FROM Stud_info s
JOIN Book_info b ON s.sid = b.sid
WHERE b.bname LIKE '%Programming%'
ORDER BY b.issue_date DESC, s.sname;
```

Expected Output:

```
Student_ID | Student_Name   | Branch          | Book_Name                | Issue_Date
-----------|----------------|-----------------|--------------------------|------------
S001       | Rahul Sharma   | Computer Science| Programming in C         | 2024-01-15
S003       | Ravi Kumar     | Mechanical      | Programming in Python    | 2024-02-20
S004       | Ram Singh      | Computer Science| Programming Fundamentals | 2024-03-05
S006       | Rakesh Gupta   | Computer Science| Java Programming         | 2024-03-12
S007       | Suresh Reddy   | Electronics     | C++ Programming          | 2024-03-15
S002       | Raj Patel      | Electronics     | Web Programming          | 2024-03-18
S004       | Ram Singh      | Computer Science| Advanced Programming     | 2024-03-20
S009       | Priya Singh    | Computer Science| Python Programming       | 2024-03-22
S010       | Neha Gupta     | Civil           | C Programming            | 2024-03-25
S003       | Ravi Kumar     | Mechanical      | Programming Basics       | 2024-03-28
```

---

âœ… d. MODIFY AUTHOR NAME OF BOOK WITH BID 'BK11001' TO 'Henry J.'

Solution 1: Simple UPDATE Statement

```sql
-- Check current data
SELECT bid, bname, author, issue_date
FROM Book_info
WHERE bid = 'BK11001';

-- Update the author name
UPDATE Book_info
SET author = 'Henry J.'
WHERE bid = 'BK11001';

-- Verify the update
SELECT bid, bname, author, issue_date
FROM Book_info
WHERE bid = 'BK11001';
```

Solution 2: UPDATE with RETURNING (PostgreSQL)

```sql
-- PostgreSQL: Update and return the modified row
UPDATE Book_info
SET author = 'Henry J.'
WHERE bid = 'BK11001'
RETURNING bid, bname, author, issue_date;
```

Solution 3: UPDATE with OUTPUT (SQL Server)

```sql
-- SQL Server: Update with output of changes
UPDATE Book_info
SET author = 'Henry J.'
OUTPUT 
    INSERTED.bid,
    INSERTED.bname,
    INSERTED.author,
    INSERTED.issue_date
WHERE bid = 'BK11001';
```

Solution 4: UPDATE with Error Handling

```sql
-- SQL Server with error handling
BEGIN TRY
    BEGIN TRANSACTION;
    
    -- Check if book exists
    IF EXISTS (SELECT 1 FROM Book_info WHERE bid = 'BK11001')
    BEGIN
        -- Backup old value (optional)
        DECLARE @old_author VARCHAR(100);
        SELECT @old_author = author FROM Book_info WHERE bid = 'BK11001';
        
        -- Perform update
        UPDATE Book_info
        SET author = 'Henry J.'
        WHERE bid = 'BK11001';
        
        -- Log the change (optional)
        INSERT INTO Book_audit (bid, old_author, new_author, change_date)
        VALUES ('BK11001', @old_author, 'Henry J.', GETDATE());
        
        PRINT 'Author name updated successfully.';
    END
    ELSE
    BEGIN
        PRINT 'Book with bid BK11001 not found.';
    END
    
    COMMIT TRANSACTION;
END TRY
BEGIN CATCH
    IF @@TRANCOUNT > 0
        ROLLBACK TRANSACTION;
    
    PRINT 'Error updating author: ' + ERROR_MESSAGE();
END CATCH
```

Expected Output (Before Update):

```
bid     | bname            | author        | issue_date
--------|------------------|---------------|------------
BK11001 | Programming in C | James Gosling | 2024-01-15
```

Expected Output (After Update):

```
bid     | bname            | author   | issue_date
--------|------------------|----------|------------
BK11001 | Programming in C | Henry J. | 2024-01-15
```

---

ðŸ“Š ADDITIONAL QUERIES FOR COMPREHENSIVE DATABASE MANAGEMENT

1. View All Students with Their Issued Books

```sql
SELECT 
    s.sid,
    s.sname,
    s.branch,
    COUNT(b.bid) AS Total_Books_Issued,
    STRING_AGG(b.bname, ', ') AS Books_Issued
FROM Stud_info s
LEFT JOIN Book_info b ON s.sid = b.sid
GROUP BY s.sid, s.sname, s.branch
ORDER BY Total_Books_Issued DESC, s.sname;
```

2. Find Students Who Haven't Issued Any Book

```sql
SELECT 
    s.sid,
    s.sname,
    s.branch,
    s.email
FROM Stud_info s
LEFT JOIN Book_info b ON s.sid = b.sid
WHERE b.bid IS NULL
ORDER BY s.sname;
```

3. Most Popular Books (Most Issued)

```sql
SELECT 
    b.bname,
    b.author,
    COUNT(b.bid) AS Times_Issued,
    COUNT(DISTINCT b.sid) AS Distinct_Students
FROM Book_info b
GROUP BY b.bname, b.author
ORDER BY Times_Issued DESC;
```

4. Books Issued in Current Month

```sql
SELECT 
    s.sname,
    b.bname,
    b.author,
    b.issue_date
FROM Stud_info s
JOIN Book_info b ON s.sid = b.sid
WHERE MONTH(b.issue_date) = MONTH(GETDATE())
AND YEAR(b.issue_date) = YEAR(GETDATE())
ORDER BY b.issue_date DESC;
```

5. Enhanced Stored Procedure with Book Details

```sql
-- Create enhanced stored procedure
CREATE PROCEDURE GetCompleteStudentInfo
    @student_pattern VARCHAR(100)
AS
BEGIN
    -- Student Information
    SELECT 'STUDENT INFORMATION' AS Info_Type;
    
    SELECT 
        sid AS ID,
        sname AS Name,
        branch AS Branch,
        semester AS Sem,
        email AS Email,
        mobno AS Mobile
    FROM Stud_info
    WHERE sname LIKE '%' + @student_pattern + '%';
    
    -- Book Information
    SELECT 'BOOKS ISSUED' AS Info_Type;
    
    SELECT 
        b.bname AS Book_Title,
        b.author AS Author,
        b.issue_date AS Issue_Date,
        DATEDIFF(day, b.issue_date, GETDATE()) AS Days_With_Student
    FROM Stud_info s
    JOIN Book_info b ON s.sid = b.sid
    WHERE s.sname LIKE '%' + @student_pattern + '%'
    ORDER BY b.issue_date DESC;
    
    -- Summary
    SELECT 
        COUNT(DISTINCT s.sid) AS Total_Students,
        COUNT(b.bid) AS Total_Books_Issued
    FROM Stud_info s
    LEFT JOIN Book_info b ON s.sid = b.sid
    WHERE s.sname LIKE '%' + @student_pattern + '%';
END;
GO

-- Execute enhanced procedure
EXEC GetCompleteStudentInfo 'Sharma';
```

6. Create Audit Table for Book Modifications

```sql
-- Create audit table
CREATE TABLE Book_info_audit (
    audit_id INT IDENTITY(1,1) PRIMARY KEY,
    bid VARCHAR(20),
    old_author VARCHAR(100),
    new_author VARCHAR(100),
    changed_by VARCHAR(100) DEFAULT SYSTEM_USER,
    change_date DATETIME DEFAULT GETDATE(),
    operation_type VARCHAR(10)
);

-- Create trigger for auditing
CREATE TRIGGER trg_book_info_audit
ON Book_info
AFTER UPDATE
AS
BEGIN
    INSERT INTO Book_info_audit (bid, old_author, new_author, operation_type)
    SELECT 
        d.bid,
        d.author,
        i.author,
        'UPDATE'
    FROM deleted d
    JOIN inserted i ON d.bid = i.bid
    WHERE d.author <> i.author;
END;
```

---

ðŸ“‹ SUMMARY OF SOLUTIONS

Task Solution Used Key Functions/Clauses
a. Stored Procedure CREATE PROCEDURE, LIKE with wildcards Parameterized search
b. Names starting with "Ra" LIKE 'Ra%', LEFT(), SUBSTRING() Pattern matching
c. Students with Programming books JOIN, LIKE '%Programming%', EXISTS Table joining, pattern search
d. Modify author name UPDATE, WHERE clause Data modification

---

ðŸŽ¯ KEY TAKEAWAYS

1. Stored Procedures encapsulate business logic and improve code reusability
2. Pattern Matching (LIKE, wildcards) is essential for flexible searches
3. JOIN operations are crucial for relating data across tables
4. UPDATE statements with WHERE clauses ensure precise data modifications
5. Always verify changes after UPDATE operations
6. Consider using transactions for critical updates to maintain data integrity
7. Create audit trails for important data modifications

---

ðŸ”§ TROUBLESHOOTING TIPS

1. If stored procedure doesn't work:
   Â· Check database compatibility
   Â· Verify parameter syntax
   Â· Ensure proper delimiter usage (in MySQL)
2. If LIKE pattern doesn't match:
   Â· Check case sensitivity (use ILIKE in PostgreSQL for case-insensitive)
   Â· Verify wildcard placement
   Â· Check for trailing/leading spaces
3. If UPDATE affects wrong rows:
   Â· Always test WHERE clause with SELECT first
   Â· Use transactions to allow rollback
   Â· Backup data before bulk updates
4. If JOIN returns unexpected results:
   Â· Check foreign key relationships
   Â· Use DISTINCT to eliminate duplicates
   Â· Verify data types match in JOIN conditions

This comprehensive solution provides all required functionality with multiple database syntax options and additional useful queries for complete database management.
